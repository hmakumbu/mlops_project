# Use an official Python image as a base
FROM python:3.11-slim

# Set the working directory in the container
WORKDIR /app

# Copy only the requirements file into the container first for caching
COPY requirements.txt .

# Install the required Python packages
RUN pip install --upgrade -r requirements.txt

# Copy the entire project directory into the container
COPY backend/app/ ./backend/app
COPY frontend/ ./frontend

# Expose the ports for FastAPI (8000) and Streamlit (8501)
EXPOSE 8000
EXPOSE 8501

# Set environment variables for Streamlit
ENV STREAMLIT_SERVER_PORT=8501
ENV STREAMLIT_SERVER_ADDRESS=0.0.0.0

# Optional: Debugging step to list files
RUN ls -la /app

# Command to run FastAPI and Streamlit
CMD /bin/bash -c "uvicorn backend.app.controller:app --host 0.0.0.0 --port 8000 & \
    sleep 5 && streamlit run frontend/test.py --server.address 0.0.0.0 --server.port 8501"
